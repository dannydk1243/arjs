<!DOCTYPE html>
<html>

<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.5/dist/mindar-image.prod.js"></script>
<script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.5/dist/mindar-image-aframe.prod.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.5/dist/mindar-image-three.prod.js"></script>
<script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js"></script>

<body>
  <div id="loading-screen">
    <div id="progress-container">
      <div id="progress-bar"></div>
    </div>
    <div id="loading-text"></div>
  </div>

  <a-scene
    mindar-image="imageTargetSrc: ./assets/target.mind; filterMinCF:0.0001; filterBeta: 0.001;  maxTrack: 1; uiLoading:no; uiScanning:no"
    color-space="sRGB" renderer="logarithmicDepthBuffer: true, colorManagement: true, physicallyCorrectLights"
    vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: true">

    <a-assets>
      <a-asset-item id="avatarModel" src="./assets/modal.glb"></a-asset-item>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity id="example-target" mindar-image-target="targetIndex: 0">
      <a-gltf-model id="animatedModel" rotation="180 90 90" position="0 0 0" scale="8 8 8" src="#avatarModel"
        animation-mixer>
      </a-gltf-model>
    </a-entity>
  </a-scene>
</body>

<script>
  const exampleTarget = document.querySelector("#example-target");
  const animatedModel = document.querySelector("#animatedModel");
  const loadingScreen = document.querySelector("#loading-screen");
    const progressBar = document.querySelector("#progress-bar");
    const loadingText = document.querySelector("#loading-text");

    let progress = 0;
    let modelLoaded = false;
    let progressComplete = false;

    // Simulate loading progress up to 100% (20% per second)
    const loadingInterval = setInterval(() => {
      if (progress < 100) {
        progress += 20;
        progressBar.style.width = progress + "%";
        // loadingText.innerText = `Loading... ${progress}%`;
      }

      // Mark progress as complete when it reaches 100%
      if (progress >= 100) {
        progressComplete = true;
        clearInterval(loadingInterval);
        hideLoadingScreen();
      }
    }, 1000);

    // Model loaded event
    animatedModel.addEventListener("loaded", () => {
      console.log("GLTF model has been loaded!");
      modelLoaded = true;
      hideLoadingScreen();
    });

    // Function to hide loading screen when both conditions are met
    function hideLoadingScreen() {
      if (progressComplete && modelLoaded) {
        setTimeout(() => {
          loadingScreen.style.opacity = "0";
          setTimeout(() => {
            loadingScreen.style.display = "none";
          }, 500); // Wait for fade-out effect
        }, 500);
      }
    }

  exampleTarget.addEventListener("targetFound", () => {
    console.log("Target found");
    animatedModel.removeAttribute("animation-mixer");
    setTimeout(() => {
      animatedModel.setAttribute("animation-mixer", "clip: *; loop: once; timeScale: 1");
      animatedModel.setAttribute("visible", "true");
    }, 50);
  });

  exampleTarget.addEventListener("targetLost", () => {
    console.log("Target lost");
    animatedModel.setAttribute("visible", "false");
    animatedModel.removeAttribute("animation-mixer");
    setTimeout(() => {
      animatedModel.setAttribute("animation-mixer", "clip: *; loop: once; timeScale: 0");
    }, 50);
  });
</script>
<style>
  .a-loader-title {
    display: none !important;
  }

  /* Fullscreen Loading Screen */
  #loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    z-index: 9999;
  }

  /* Progress Bar Container */
  #progress-container {
    width: 80%;
    max-width: 400px;
    background: #333;
    border-radius: 10px;
    overflow: hidden;
  }

  /* Progress Bar */
#progress-bar {
  height: 20px;
  width: 0%;
  background: linear-gradient(90deg, #00d2d5, #4b6ae5, #8315d2);
  transition: width 0.2s ease-in-out;
}

  /* Loading Text */
  #loading-text {
    color: white;
    margin-top: 10px;
    font-size: 18px;
  }
</style>

</html>